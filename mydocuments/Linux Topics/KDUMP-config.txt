KDUMP/CRASHDUMP CONFIGURATION EXAMPLE OF AN RHEL6 NODE

Below are the configuration level changes for kdump/vmcore data generation which can force Kernel to go into panic when OS cannot safely recover from any fatal error

1.kdump package to be installed
2.Path for vmcore dump need to be corrected as /var/crash and size has to be set equal or more than Physical memory Size.
3.All kernel parameter must be configured in order to get kernel panic/crash upon detection of any internal fatal error/out of resources, from which OS cannot safely recover


>>> kdump packages must be installed
# rpm -qa|grep kexec-tools
kexec-tools-2.0.0-300.el6.x86_64

>>>> kdump package will ensure crashkernel is configured. Can be seen in /etc/grub.conf as well
# cat /proc/cmdline
ro root=/dev/mapper/vg00-rootvol rd_NO_LUKS LANG=en_US.UTF-8 rd_LVM_LV=vg00/rootvol rd_NO_MD SYSFONT=latarcyrheb-sun16  rd_LVM_LV=vg00/swapvol  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM elevator=noop audit=1 crashkernel=135M@0M



>>> vmcore file configurations must be as per the location path where we need to store crashdump data/file once system crash
# grep -v "#" /etc/kdump.conf
ext4 /dev/mapper/vg00-crashvol   <<<< only path alone is sufficient we can comment out this
path /                             <<<<<<<< path must be /var/crash
core_collector makedumpfile -c -d 3


# df -h |grep crashvol -A1
/dev/mapper/vg00-crashvol
                      1.1G  1.5M  1.1G   1% /var/crash     <<<<<<<< /var/crash size must be equal to Physical RAM



>>>>kdump service must be running
# service kdump status
Kdump is operational

>>>> Physical RAM is of 96GB
# free -m
             total       used       free     shared    buffers     cached
Mem:         96739      60640      36099         31        238      32401
-/+ buffers/cache:      28000      68739
Swap:        32767          0      32767

>>>>> Below highlighted kernel parameters value need to be set as 1 in /etc/sysctl.conf in order to force server to go panic crash on OOM & and any other hardware issue
# sysctl -a|egrep -i "panic|nmi|sys"
kernel.sysrq = 1
kernel.panic_on_oops = 1
kernel.hardlockup_panic = 1
kernel.nmi_watchdog = 1
kernel.unknown_nmi_panic = 0      <<<<<<<<< Value must be 1
kernel.panic_on_unrecovered_nmi = 0  <<<<<<<<< Value must be 1
kernel.panic_on_io_nmi = 0    <<<<<< Value must be 1
vm.panic_on_oom = 0     <<<<<<<< Value must be 1
